<div
  class="wave-bg fixed inset-0 z-0 overflow-hidden blur-2xl"
  aria-hidden="true"
>
  <canvas id="waveCanvas" class="opacity-80 mix-blend-screen"></canvas>

  <script type="module">
    const canvas = document.getElementById('waveCanvas');
    if (canvas) {
      const ctx = canvas.getContext('2d');
      const dpr = window.devicePixelRatio || 1;

      const rootStyles = getComputedStyle(document.documentElement);
      const baseColor =
        rootStyles.getPropertyValue('--color-base').trim() || '#050505';
      const accent =
        rootStyles.getPropertyValue('--color-accent').trim() || '#ffd600';
      const accentSoft =
        rootStyles.getPropertyValue('--color-accent-soft').trim() || '#fff1a6';

      function resize() {
        const { innerWidth: w, innerHeight: h } = window;
        canvas.width = w * dpr;
        canvas.height = h * dpr;
        ctx.setTransform(dpr, 0, 0, dpr, 0, 0);
      }

      window.addEventListener('resize', resize);
      resize();

      const lines = [
        { y: 0.25, amp: 0.20, freq: 1.3, speed: 0.5, noise: 0.9 },
        { y: 0.50, amp: 0.28, freq: 1.7, speed: 0.7, noise: 1.3 },
        { y: 0.75, amp: 0.22, freq: 1.2, speed: 0.4, noise: 1.0 }
      ];

      let lastTime = 0;
      let time = 0;

      function draw(timestamp) {
        const dt = (timestamp - lastTime) || 16;
        lastTime = timestamp;
        time += dt * 0.001;

        const width = canvas.width / dpr;
        const height = canvas.height / dpr;

        // sfondo molto scuro ma leggermente "fumoso"
        ctx.fillStyle = baseColor;
        ctx.globalAlpha = 0.96;
        ctx.fillRect(0, 0, width, height);

        const gradient = ctx.createLinearGradient(0, 0, width, 0);
        gradient.addColorStop(0, accentSoft);
        gradient.addColorStop(0.5, accent);
        gradient.addColorStop(1, accentSoft);

        ctx.lineWidth = 4;
        ctx.strokeStyle = gradient;
        ctx.globalAlpha = 0.9;

        lines.forEach((line, idx) => {
          const baseY = line.y * height;

          // Ampiezza pseudo-casuale
          const ampFactor =
            0.4 +
            0.6 *
              Math.abs(
                Math.sin(time * line.noise + idx * 1.7)
              );

          const amp = line.amp * height * ampFactor;
          const freq = line.freq;
          const speed = line.speed;

          ctx.beginPath();
          const step = 5;

          for (let x = 0; x <= width + step; x += step) {
            const progress = x / width;
            const phase = time * speed * 5 + progress * freq * Math.PI * 2;

            // leggero envelope per non avere bordi piatti
            const envelope =
              0.4 +
              0.6 *
                Math.sin(progress * Math.PI + Math.sin(time * 0.5 + idx));

            const noise =
              (Math.random() - 0.5) * 0.08 * height * line.amp;

            const y = baseY + Math.sin(phase) * amp * envelope + noise;

            if (x === 0) ctx.moveTo(x, y);
            else ctx.lineTo(x, y);
          }

          ctx.stroke();
        });

        requestAnimationFrame(draw);
      }

      requestAnimationFrame(draw);
    }
  </script>
</div>
